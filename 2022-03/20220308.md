# Delegation pattern

Delegation를 공부했을 때 느낀 것은 대신 책임을 할당한 곳에 할당해서 원래 내가 해야할 일을 할당한 곳이 대신 해준다고 생각하게 되었다. 그래서 이를 바탕으로 데이터를 전송할 수도 있는 것을 파악했다.

이 마음을 가지고 친구와 대화를 하며 소크라테스식? 공부법을 해봤다!

친구가 나에게 대신 다른사람에게 메시지를 전해달라고 했다.

친구 A, 나 B 라고 명명한다.

B: 이런게 delegate 인거니? 친구이름.delegate = self 하면 self는 나인거잖아 

A: 딜리게이트하면 생각나는 개념 하나 더 없니?

A:  딜리게이트 패턴이 뭐에여?

B: 델리게이터 패턴이란 내가 해야할 일을 위임자에게 맡겨서 책임을 넘기는 것, 보내는놈이 프로토콜 선언해서 그 속 함수에 이쁘게 data넣어서 보내서 받으면 받아서 바꾸면 되는거 아닌가?

A: data 꼭 넣어야돼? 왜 딜리게이트 패턴 써야할까? 언제필요할까?

B: 위임자랑 동일한 것인데 변경이 있는 경우 data 넣어야하지.. 음.. 꼭 넣어야대나? 안넣으면 왜써? 요런 생각인데

A: data없이 특정 동작을 할 수도 있지 않을까? 

B: 화면전환? 

A: 화면전환은 딜리게이트가 뭔가 역할이 이상하지 않을까?

B: 흠..

A: A가잇고 B가 잇을때 뭔가 A가 B의 딜리게이트고 B는 A의 딜리게이트가 아니면딜리게이트 통해서 뭔가 명령을 전달하는 거 말고 반대로는 통신이 안되나? 테이블 뷰 딜리게이트 뭔지 아나 에디 테이블뷰 아직 안쓰나

B: 아직 안배웠다!!!

A:  테이블뷰랑 뷰컨이랑 딜리게이트 관계가 오또케되나여

B: 안 배 웠 다

B: 화면전환 할때 데이터 전송할 때만 사용해봤다!

A: 화면 전환하는 방법은 무엇이 있어?

B: present, push

A: 음..모달 네비게이션 말하는거구나 그거말고 세그 아니?

B: segue? 알지 

A: segue 어떻게 설정해?

B: 스토리보드로 할 수 있고 코드로 할 수 있다?!

A: 코드로 했다고?

B: 아..

A: 세그 + 액션, 세그 + 코드  후자?

B: 아 네비컨트롤러에 하는게 아니구나?

이상한 소리해서 생략

B: 아 이건 인스턴스 만드는 것 코드로 만든거고 이거의 네이밍에 segue는 없구나?

A: 네비게이션컨트롤러안에 뷰컨트롤러가 있는건 세그라고 안하지 않나?

B: 지송.. 아 그래서 왜 델리게이터 패턴 쓰냐면 책임분리 아닐까? 역할 분리, 혼자 뷰컨이 다하면 힘드니까 나누는게 낫지않나?

A: 뷰컨이 다하면 힘들어서 뷰모델을 만들어서 거기서 막 데이터를 관리하고 있어

B: mvvm 이네

A: 그럼 뷰컨이랑 뷰모델은 어떻게 통신해?

B: 그게 델리게이터 패턴이랑 연관있어?
A: YES

B: 뷰컨에서 일부 기능을 뷰모델이 대신하는거잖아

A: 맞아 보통 데이터를 관리해

B: 관리하는건 뷰모델 그럼 뷰컨은?

A: 뭐할거같아?

B: 연결해주는 것만 해주겠지 중개자로, 뷰모델이 모델이랑 놀다가 뷰컨에 말하고 뷰컨에 데이터를 뷰에 보내고 보내고 받는 역할이 뷰컨이 아닐까?

A: 맞아

B: 그래서 왜 쓰냐! 델리게이터패턴!

A: 일단 뷰컨은 사실 컨트롤러인데 뷰가 붙어있잖아 그게 노답이야

B: 맞지

A: 그래서 컨트롤러가 뷰랑 데이터랑 막 관리해야하는데 뷰는 거의 컨트롤러에 붙어있다싶어. 근데 사실에 뷰모델안쓰고 뷰컨에 다 넣어도 되잖아?

B: ㅇㅇ!

A: 근데 아까 너가 말한것처럼 뷰컨이 2000줄되고 하면 너무 헤비하고 관리도 안되니까 역할을 분리하자해서 데이터 관련된거, 비즈니스 로직 같은건 뷰모델이 다 보내고 뷰컨은 화면 관련된 컨트롤만 들고있자 했지

A: 그러면 일단 우리는 화면을 보여줄라면 뷰컨을 생성해야겠지? 그럼 뷰랑 컨트롤러는 생겼어 그럼 뷰모델은 어디다 만들어?

B: 어디?..어디다가?

A: 난 첨에 MVVM할떄 이해가 안된게 뷰랑 컨트롤러랑 뷰모델이랑 뭔가 다 동급처럼 이야기하는데 뷰컨도 막 화면전환할 때 보면 아까 너가 말한 코드 초기화처럼 인스턴스 생성해서 화면에 띄어주자나. 근데 뷰모델 인스턴스는 어딨는 걸까? 어디다 만들어ㅑ할까?

B: 뷰컨?

A: 맞지 그럼 뷰 모델은 뷰컨소유네?

B: 그래서 뷰컨에서 뷰에 쏴줘야지 ??

A: 그럼 뷰컨이 뷰도 들고 있고 뷰모델도 들고있네? 데이터를 생성하고 끝내는게 아니라 뷰컨이 작동하면서 같이 변경될 수도 있잖아, 그니까 우리가 쥬스가게를 열어서 바나나를 썼지?

그러면 그 바나나 개수가 데이터라고 할 수 있으니 뷰컨이 들고 있으니까 한번 생성하고 없애져버리면 데이터관리가 안되기 때문에 뷰컨이 계속 뷰모델을 들고 있겠지

B: 그치 업데이트 해줘야대니까

A: 그치 새로 매번 만들면 재고가 10개니까 영원히 행복하곘는데?

B: 부자되겠어

A: 뷰컨에서 뷰모델을 생성했으니까 코드레벨로 보면 vc { let viewModel } 이런식 가지고있지? 그럼 뷰컨에서 막 viewModel.바나나쓰기 이런식으로 쓰겠지? 그럼 바나나 다 썼다고 뷰모델이 뷰컨에 말하고싶어 어케해?

B: 먼저 뷰컨에서 뷰모델에 말하고 뷰모델이 그에 맞는 로직을 보내는게 순서아닌가?

A: 뷰모델이 근데 완료됐다고 말하고 싶대

B: 뷰 -> 뷰컨 -> 뷰모델 -> 뷰컨 -> 뷰 아녀?

A: 그래서 뷰모델 > 뷰컨 어케해??

B: 머리가 띵해... 가능해그게?
A: 생각나는게없지?.. 나두없어...

A: 그떄 델리게이트를 쓰는거야!!!! 뷰컨은 뷰모델을 알아서 명령하거나 데이터 바꾸라고 막할수있는데 뷰모델은 반대로 못해주자나

B: 아 노예 부리는구나!! 뷰컨이 왕이고 노예는 뷰모델인데 감히 노예가 왕에게 명령해? 불가능하지

B: 그럼 단방향이겠네?

A: 그치! 프로토콜 씌우고 주어진 함수로 막 하자나 반대로는 똑같이 델리게이터 씌어줘야돼 그러면 서로 딜리게이트인데 사실 딜리게이트를 하나 설정해줄라면 걔를 들고있을텐데 또 설정해주면 아이러니가된거지

B: 강한참조가 되는거야?

A: 아니 이미 딜리게이트 자체로 weak 안쓰면 강한참조야

B: 그럼 만약 서로해주면 어케돼?

A: XX같은 코드가 되는거지, 뷰컨에서 viewModel.바나나쓰기 이케하면되는데 굳이 viewModel.delegate.바나나쓰기 이런느낌일수도...

B: 글쿠나 분리안댄느낌이네 저렇게 하면안되겠다!

B: 그럼 모델이랑 뷰모델의 관계는? 동일한건가? 모델이 뷰모델이 말걸수없으니까 뷰모델이 요청하면 응답해주는것만 가능한건가?

A: 모델은 무엇일까? 모델은 실제로 역할을 하는가?

B: 객체들의 집합소.. 역할 안하지 데이터 저장만하지

A: 사람들이 설명하는게 딜리게이터가 비서다 이렇게하고 모델 뷰모델 뷰 이러니까 내 생각엔 관계성이 더 이상해보였어 내가봤을 떄 모델은 JSON 데이터야, 어떻게 받을지 담아놓는 통같은

B: 아 그럼 속비어있지만 분류되어있는통, 받아온 데이터 슥슥 통에 넣기위한곳 이라생각?

A: 난 글케 생각해. 모델에서 먼가 컨트롤 할수도있어 모델단에서 비즈니스 로직도 가질 수 있고 데이터 가공 쓸수도있는데 실제 일할때에는 codable 이거만 달고 파싱준비만 하더라구?

B: 아항 나도 플젝할떄 대부분 그리 분리하더라고!! 그럼 생각드는데 요번꺼 할 때 초기화해주고 과일소비하느 메소드, 저장프로퍼티 있는데 이럼 안되잖아? 뷰컨에서 해야대는건가원래?

A: 지금은 뷰모델이 없어서 뷰컨 모델에서 각각 비즈니스 로직을 가져간것이라고 생각하면돼!

모델에서 그런 역할 해주는건 좋은거지!

B: 오 헷갈렸던 부분 이해됐다!!